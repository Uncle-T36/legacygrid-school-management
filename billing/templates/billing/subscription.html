{% extends 'billing/base.html' %}

{% block title %}Subscription Management - LegacyGrid{% endblock %}

{% block page_title %}Subscription Management{% endblock %}

{% block billing_content %}
{% if demo_mode %}
<div class="alert alert-warning">
    <strong>‚ö†Ô∏è Demo Mode Active:</strong> No real charges will be made. All transactions are for testing only.
</div>
{% endif %}

<div class="alert alert-info">
    <strong>üîí Owner Access:</strong> You are viewing this page as the system owner (Uncle-T36). 
    This page manages all user subscriptions and billing across the platform.
</div>

<!-- Premium Upgrade Card -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">üíé Premium Subscription</h3>
        <p class="card-subtitle">Unlock advanced features and capabilities</p>
    </div>
    
    <div class="premium-features">
        <div class="features-grid grid grid-cols-2">
            <div class="feature-item">
                <span class="feature-icon">ü§ñ</span>
                <div>
                    <h5>AI-Powered Analytics</h5>
                    <p>Advanced student performance analysis with machine learning insights</p>
                </div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üí¨</span>
                <div>
                    <h5>Advanced Messaging</h5>
                    <p>Multi-language support and encrypted communication channels</p>
                </div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üìä</span>
                <div>
                    <h5>Premium Dashboard</h5>
                    <p>Real-time analytics and customizable reporting tools</p>
                </div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üîÑ</span>
                <div>
                    <h5>Real-time Sync</h5>
                    <p>Instant data synchronization across all platforms</p>
                </div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üìß</span>
                <div>
                    <h5>Automated Notifications</h5>
                    <p>Smart email alerts and system notifications</p>
                </div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üéØ</span>
                <div>
                    <h5>Custom Reports</h5>
                    <p>Generate tailored reports with advanced filtering</p>
                </div>
            </div>
        </div>
        
        <div class="pricing-section text-center mt-4">
            <div class="price-display">
                <span class="currency">$</span>
                <span class="amount">29.99</span>
                <span class="period">/month</span>
            </div>
            
            {% if demo_mode %}
                <button id="checkout-button" class="btn btn-primary" disabled>
                    üí≥ Demo Mode - Payments Disabled
                </button>
                <p class="demo-notice">
                    In demo mode, payments are disabled for testing purposes.
                </p>
            {% else %}
                <button id="checkout-button" class="btn btn-primary">
                    üí≥ Upgrade to Premium
                </button>
            {% endif %}
        </div>
    </div>
</div>

<!-- Subscription Settings Card -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="card-title">‚öôÔ∏è Subscription Settings</h3>
        <p class="card-subtitle">Manage your subscription preferences</p>
    </div>
    
    <div class="settings-grid grid grid-cols-1">
        <div class="setting-item">
            <div class="setting-info">
                <h5>Current Plan</h5>
                <p>Free Tier - Basic features included</p>
            </div>
            <div class="setting-action">
                <span class="badge badge-secondary">Active</span>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h5>Billing Cycle</h5>
                <p>Monthly recurring billing</p>
            </div>
            <div class="setting-action">
                <button class="btn btn-secondary">Change</button>
            </div>
        </div>
        
        <div class="setting-item">
            <div class="setting-info">
                <h5>Payment Method</h5>
                <p>No payment method on file</p>
            </div>
            <div class="setting-action">
                <button class="btn btn-secondary">Add Card</button>
            </div>
        </div>
    </div>
</div>

<!-- Security Notice Card -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">üîí Security & Compliance</h3>
    </div>
    
    <div class="security-info">
        <div class="security-item">
            <span class="security-icon" style="color: var(--success);">‚úì</span>
            <div>
                <h5>PCI DSS Compliant</h5>
                <p>All payment processing meets industry security standards</p>
            </div>
        </div>
        
        <div class="security-item">
            <span class="security-icon" style="color: var(--success);">‚úì</span>
            <div>
                <h5>Data Encryption</h5>
                <p>End-to-end encryption for all financial transactions</p>
            </div>
        </div>
        
        <div class="security-item">
            <span class="security-icon" style="color: var(--success);">‚úì</span>
            <div>
                <h5>Access Control</h5>
                <p>Restricted to verified owner account (Uncle-T36)</p>
            </div>
        </div>
        
        <div class="contact-support">
            <p><strong>Support Contact:</strong> {{ support_email|default:"support@legacygrid.co.zw" }}</p>
        </div>
    </div>
</div>

<!-- Additional CSS for this page -->
<style>
.features-grid {
  gap: var(--spacing-lg);
}

.feature-item {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--glass-bg);
  border-radius: var(--radius-md);
  transition: var(--transition-fast);
}

.feature-item:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
}

.feature-icon {
  font-size: 2rem;
  color: var(--neon-cyan);
  flex-shrink: 0;
}

.feature-item h5 {
  margin: 0 0 var(--spacing-xs) 0;
  color: var(--text-primary);
  font-weight: 600;
}

.feature-item p {
  margin: 0;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.pricing-section {
  background: var(--glass-bg);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  margin-top: var(--spacing-xl);
}

.price-display {
  margin-bottom: var(--spacing-lg);
}

.currency {
  font-size: 1.5rem;
  color: var(--text-secondary);
  vertical-align: top;
}

.amount {
  font-size: 3rem;
  font-weight: 700;
  color: var(--neon-cyan);
}

.period {
  font-size: 1.2rem;
  color: var(--text-secondary);
}

.demo-notice {
  margin-top: var(--spacing-md);
  color: var(--text-muted);
  font-size: 0.9rem;
}

.settings-grid,
.security-info {
  gap: var(--spacing-md);
}

.setting-item,
.security-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-md);
  background: var(--glass-bg);
  border-radius: var(--radius-md);
}

.security-item {
  justify-content: flex-start;
  gap: var(--spacing-md);
}

.security-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.setting-info h5,
.security-item h5 {
  margin: 0 0 var(--spacing-xs) 0;
  color: var(--text-primary);
  font-weight: 600;
}

.setting-info p,
.security-item p {
  margin: 0;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.contact-support {
  margin-top: var(--spacing-lg);
  padding-top: var(--spacing-lg);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  text-align: center;
}

@media (max-width: 768px) {
  .features-grid {
    grid-template-columns: 1fr;
  }
  
  .setting-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-md);
  }
  
  .setting-action {
    width: 100%;
    text-align: center;
  }
}
</style>
{% endblock %}

{% block extra_js %}
{% if stripe_public_key and not demo_mode %}
<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe('{{ stripe_public_key }}');
    
    document.getElementById('checkout-button').addEventListener('click', function() {
        fetch('/billing/create-checkout-session/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: JSON.stringify({
                'price_id': '{{ stripe_price_id }}',
                'success_url': '{{ domain }}/billing/success/',
                'cancel_url': '{{ domain }}/billing/cancel/',
            })
        })
        .then(function(response) {
            return response.json();
        })
        .then(function(session) {
            return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function(result) {
            if (result.error) {
                LegacyGrid.showAlert(result.error.message, 'danger');
            }
        })
        .catch(function(error) {
            console.error('Error:', error);
            LegacyGrid.showAlert('An error occurred. Please try again.', 'danger');
        });
    });
</script>
{% endif %}
{% endblock %}