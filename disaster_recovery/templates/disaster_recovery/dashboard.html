{% extends 'billing/base.html' %}

{% block title %}Disaster Recovery Dashboard - LegacyGrid{% endblock %}

{% block content %}
<h2>🚨 Disaster Recovery Control Center (Owner Only)</h2>

{% if demo_mode %}
<div class="alert alert-warning">
    <strong>⚠️ Demo Mode Active:</strong> All disaster recovery operations are simulated for testing only.
</div>
{% endif %}

<div class="alert alert-info">
    <strong>🔒 Owner Access:</strong> You are viewing this page as the system owner (Uncle-T36). 
    This module manages critical infrastructure and disaster recovery operations.
</div>

<!-- Quick Stats Dashboard -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div style="padding: 20px; border: 1px solid #28a745; border-radius: 8px; background: #d4edda;">
        <h4>📦 Recent Backups</h4>
        <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ recent_backups|length }}</p>
        <p>Last 10 backup operations</p>
        <a href="{% url 'backup_management' %}" class="btn btn-success btn-sm">Manage Backups</a>
    </div>
    
    <div style="padding: 20px; border: 1px solid #007bff; border-radius: 8px; background: #d1ecf1;">
        <h4>🔄 Active Failovers</h4>
        <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ active_failovers|length }}</p>
        <p>Monitoring configurations</p>
        <a href="{% url 'failover_configuration' %}" class="btn btn-primary btn-sm">Configure Failover</a>
    </div>
    
    <div style="padding: 20px; border: 1px solid #ffc107; border-radius: 8px; background: #fff3cd;">
        <h4>🔔 Pending Notifications</h4>
        <p style="font-size: 24px; font-weight: bold; margin: 10px 0;">{{ pending_notifications|length }}</p>
        <p>Awaiting delivery</p>
        <a href="{% url 'downtime_notifications' %}" class="btn btn-warning btn-sm">Manage Notifications</a>
    </div>
    
    <div style="padding: 20px; border: 1px solid #17a2b8; border-radius: 8px; background: #d1ecf1;">
        <h4>📊 System Health</h4>
        <p style="font-size: 24px; font-weight: bold; margin: 10px 0; color: #28a745;">✅ Operational</p>
        <p>All systems green</p>
        <button id="health-check-btn" class="btn btn-info btn-sm">Run Health Check</button>
    </div>
</div>

<!-- Recent Activity -->
<div style="margin-top: 30px;">
    <h3>📋 Recent Backup Activity</h3>
    {% if recent_backups %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead style="background: #f8f9fa;">
                <tr>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Backup Name</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Type</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Status</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Created</th>
                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Size</th>
                </tr>
            </thead>
            <tbody>
                {% for backup in recent_backups %}
                <tr>
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ backup.name }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">
                        <span style="padding: 4px 8px; border-radius: 4px; background: #e9ecef; font-size: 12px;">
                            {{ backup.get_backup_type_display }}
                        </span>
                    </td>
                    <td style="padding: 12px; border: 1px solid #ddd;">
                        {% if backup.status == 'completed' %}
                            <span style="color: #28a745; font-weight: bold;">✅ {{ backup.get_status_display }}</span>
                        {% elif backup.status == 'failed' %}
                            <span style="color: #dc3545; font-weight: bold;">❌ {{ backup.get_status_display }}</span>
                        {% elif backup.status == 'in_progress' %}
                            <span style="color: #ffc107; font-weight: bold;">⏳ {{ backup.get_status_display }}</span>
                        {% else %}
                            <span style="color: #6c757d; font-weight: bold;">⏸️ {{ backup.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td style="padding: 12px; border: 1px solid #ddd;">{{ backup.created_at|date:"M d, Y H:i" }}</td>
                    <td style="padding: 12px; border: 1px solid #ddd;">
                        {% if backup.file_size %}
                            {{ backup.file_size|filesizeformat }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f8f9fa; text-align: center;">
        No backup operations recorded yet. <a href="{% url 'backup_management' %}">Create your first backup</a>
    </p>
    {% endif %}
</div>

<!-- Quick Actions -->
<div style="margin-top: 30px; padding: 20px; border: 1px solid #007bff; border-radius: 8px; background: #f8f9fa;">
    <h3>⚡ Quick Actions</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
        <a href="{% url 'backup_management' %}" class="btn btn-primary">📦 Create Backup</a>
        <a href="{% url 'failover_configuration' %}" class="btn btn-info">🔄 Setup Failover</a>
        <a href="{% url 'downtime_notifications' %}" class="btn btn-warning">🔔 Send Alert</a>
        <button id="export-logs-btn" class="btn btn-secondary">📄 Export Logs</button>
    </div>
</div>

<!-- Security Notice -->
<div style="margin-top: 30px; padding: 20px; border: 1px solid #dc3545; border-radius: 8px; background: #f8d7da;">
    <h3>⚠️ Critical Security Notice</h3>
    <p><strong>Disaster Recovery Access:</strong> This module contains critical infrastructure controls and is accessible only to the verified owner account (Uncle-T36).</p>
    <p><strong>Data Protection:</strong> All backup and recovery operations are encrypted and protected according to industry standards.</p>
    <p><strong>Emergency Support:</strong> For security issues or emergency recovery, contact {{ support_email|default:"support@legacygrid.co.zw" }}</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Health Check Button
    document.getElementById('health-check-btn').addEventListener('click', function() {
        this.disabled = true;
        this.textContent = 'Checking...';
        
        // Simulate health check
        setTimeout(() => {
            this.disabled = false;
            this.textContent = 'Run Health Check';
            alert('✅ All systems operational!\n\n• Database: Online\n• Backup Storage: Available\n• Failover Systems: Ready\n• Notification Service: Active');
        }, 2000);
    });
    
    // Export Logs Button
    document.getElementById('export-logs-btn').addEventListener('click', function() {
        {% if demo_mode %}
        alert('📄 Demo Mode: Log export feature available in production mode.');
        {% else %}
        // In production, this would trigger actual log export
        window.location.href = '/disaster-recovery/api/export-logs/';
        {% endif %}
    });
});
</script>
{% endblock %}